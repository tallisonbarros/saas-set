{% extends "core/base.html" %}
{% load static %}

{% block title %}Detalhe{% endblock %}

{% block content %}
  <div class="page-logo">
    <img class="logo logo-small" src="{% static 'core/logoset.png' %}" alt="Logo">
  </div>
  <div class="page-panel-link">
    <a class="btn btn-ghost icon-only" href="{% url 'painel' %}" title="Painel" aria-label="Painel">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 11.5L12 4l8 7.5v7.5a1 1 0 0 1-1 1h-4.5v-6h-5v6H5a1 1 0 0 1-1-1z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round" stroke-linecap="round"></path>
      </svg>
    </a>
  </div>
  <section class="card stack">
    <div>
      <h1 style="margin: 0 0 8px 0;">{{ proposta.nome }}</h1>
      <div class="muted">{{ proposta.descricao|linebreaksbr }}</div>
    </div>
    <div class="stack">
      <div><strong>Codigo:</strong> {{ proposta.codigo }}</div>
      <div><strong>Prioridade:</strong> {{ proposta.prioridade }}</div>
      <div><strong>Status:</strong> {{ proposta.get_status_display }}</div>
      <div><strong>Valor:</strong> R$ {{ proposta.valor }}</div>
      <div><strong>Criado em:</strong> {{ proposta.criado_em }}</div>
      {% if proposta.decidido_em %}
        <div><strong>Decidido em:</strong> {{ proposta.decidido_em }}</div>
      {% endif %}
      {% if proposta.aprovado_por %}
        <div><strong>Decidido por:</strong> {{ proposta.aprovado_por.username }}</div>
      {% endif %}
    </div>
    <div class="detail-actions">
      <form method="post" action="{% url 'salvar_observacao' proposta.pk %}">
        {% csrf_token %}
        <label for="id_prioridade">Prioridade (1 a 99)</label>
        <input id="id_prioridade" type="number" name="prioridade" min="1" max="99" value="{{ proposta.prioridade }}">
        <label for="id_observacao">Observacao</label>
        <textarea id="id_observacao" name="observacao">{{ proposta.observacao_cliente }}</textarea>
        <button class="btn btn-ghost" type="submit">Salvar</button>
      </form>
      {% if proposta.status == "PENDENTE" %}
        <div style="display: flex; gap: 12px;">
          <form method="post" action="{% url 'aprovar_proposta' proposta.pk %}">
            {% csrf_token %}
            <button class="btn btn-primary" type="submit">Aprovar</button>
          </form>
          <form method="post" action="{% url 'reprovar_proposta' proposta.pk %}">
            {% csrf_token %}
            <button class="btn btn-outline" type="submit">Reprovar</button>
          </form>
        </div>
      {% endif %}
    </div>
    <a class="btn btn-outline" href="{% url 'propostas' %}">Voltar</a>
  </section>
{% endblock %}
