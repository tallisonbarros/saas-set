{% extends "core/base.html" %}
{% load static %}

{% block title %}Configuracoes do sistema{% endblock %}

{% block breadcrumbs %}
  <nav class="page-crumbs" aria-label="Breadcrumb">
    <a href="{% url 'painel' %}">Painel</a>
    <span class="crumb-sep">/</span>
    <span>Configuracoes</span>
  </nav>
{% endblock %}

{% block content %}
  <section class="card stack">
    <div class="page-hud">
      <div class="hud-top">
        <div class="hud-title">Painel do sistema</div>
        <div class="hud-pill">Configuracoes</div>
      </div>
      <div class="page-hud-head">
        <div>
          <div class="page-kicker">Administracao</div>
          <h1 class="page-title">Configuracoes do sistema</h1>
          <p class="page-subtitle">Cadastros base e configuracoes globais.</p>
        </div>
        <div class="page-actions">
          <a class="btn btn-ghost" href="{% url 'painel' %}">Painel</a>
        </div>
      </div>
      <div class="hud-meta">Controle de tipos, acessos e parametros.</div>
    </div>
    {% if message %}
      <p class="muted">{{ message }}</p>
    {% endif %}

    <div class="panel-grid">
      <a class="panel-card" href="{% url 'usuarios' %}">
        <div class="panel-title">Usuarios e Perfis</div>
        <div class="muted">Criar usuarios, tipos de perfil e IDs.</div>
      </a>
      <a class="panel-card" href="{% url 'ios_list' %}">
        <div class="panel-title">Tipos de IO</div>
        <div class="muted">Gerenciar classificacao de canais.</div>
      </a>
      <a class="panel-card" href="{% url 'financeiro_nova' %}">
        <div class="panel-title">Status de compras</div>
        <div class="muted">Cadastrar novos status financeiros.</div>
      </a>
      <a class="panel-card" href="{% url 'financeiro_cadernos' %}">
        <div class="panel-title">Cadernos</div>
        <div class="muted">Gerenciar cadernos e IDs financeiros.</div>
      </a>
      <a class="panel-card" href="/admin/">
        <div class="panel-title">Administracao Django</div>
        <div class="muted">Opcoes avancadas do sistema.</div>
      </a>
    </div>


    <div class="card compact-card">
      <div class="panel-title">Classificacao de canais</div>
      <div class="channel-types">
        {% for channel in channel_types %}
          <span class="channel-pill">{{ channel.nome }}</span>
        {% endfor %}
        <form method="post" class="channel-type-form">
          {% csrf_token %}
          <input type="hidden" name="action" value="create_channel_type">
          <input type="text" name="nome" placeholder="NOVO TIPO" maxlength="20" required>
          <button class="btn btn-outline" type="submit">Adicionar tipo</button>
        </form>
      </div>
    </div>

    <div class="card compact-card">
      <div class="panel-title">Tipos de ativo</div>
      <div class="channel-types">
        {% for tipo in tipos_ativos %}
          <span class="channel-pill {% if not tipo.ativo %}is-off{% endif %}">
            {{ tipo.nome }} ({{ tipo.codigo }})
          </span>
          <form method="post" class="inline-form">
            {% csrf_token %}
            <input type="hidden" name="action" value="toggle_tipo_ativo">
            <input type="hidden" name="tipo_id" value="{{ tipo.id }}">
            <button class="btn btn-outline btn-compact" type="submit">
              {% if tipo.ativo %}Desativar{% else %}Ativar{% endif %}
            </button>
          </form>
        {% endfor %}
        <form method="post" class="channel-type-form">
          {% csrf_token %}
          <input type="hidden" name="action" value="create_tipo_ativo">
          <input type="text" name="nome" placeholder="Novo tipo" maxlength="80" required>
          <input type="text" name="codigo" placeholder="SIGLA" maxlength="10" required data-uppercase>
          <button class="btn btn-outline" type="submit">Adicionar tipo</button>
        </form>
      </div>
    </div>

  </section>
  <script>
    (function () {
      var fields = document.querySelectorAll("[data-uppercase]");
      fields.forEach(function (input) {
        input.addEventListener("input", function () {
          input.value = input.value.toUpperCase();
        });
      });
    })();
  </script>
{% endblock %}
