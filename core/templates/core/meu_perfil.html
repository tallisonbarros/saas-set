{% extends "core/base.html" %}
{% load static %}

{% block title %}Meu Perfil{% endblock %}

{% block breadcrumbs %}
  <nav class="page-crumbs" aria-label="Breadcrumb">
    <a href="{% url 'painel' %}">Painel</a>
    <span class="crumb-sep">/</span>
    <span>Meu perfil</span>
  </nav>
{% endblock %}

{% block content %}
  <section class="card stack">
    <div class="page-hud">
      <div class="hud-top">
        <div class="hud-title">Painel de perfil</div>
        <div class="hud-pill">Dados</div>
      </div>
      <div class="page-hud-head">
        <div>
          <div class="page-kicker">Usuario</div>
          <h1 class="page-title">Meu perfil</h1>
          <p class="page-subtitle">Atualize dados e IDs vinculados.</p>
        </div>
        <div class="page-actions">
          <a class="btn btn-ghost" href="{% url 'painel' %}">Voltar ao painel</a>
        </div>
      </div>
      <div class="hud-meta">Perfil, plantas e financeiros.</div>
    </div>
    {% if message %}
      <p class="muted">{{ message }}</p>
    {% endif %}

    <div class="user-page-grid">
      <div class="card compact-card">
        <h2 style="margin-top: 0;">Dados</h2>
        <form method="post" class="stack">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_user">
          <label class="field">
            <span>Email</span>
            <input type="email" name="email" value="{{ request.user.username }}" required>
          </label>
          <button class="btn btn-primary" type="submit">Salvar conta</button>
        </form>
      </div>

      <div class="card compact-card">
        <h2 style="margin-top: 0;">Perfil</h2>
        <form method="post" class="stack">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_profile">
          <label class="field">
            <span>Nome</span>
            <input type="text" name="nome" value="{% if perfil %}{{ perfil.nome }}{% endif %}">
          </label>
          <label class="field">
            <span>Empresa</span>
            <input type="text" name="empresa" value="{% if perfil %}{{ perfil.empresa }}{% endif %}">
          </label>
          <label class="field">
            <span>Sigla cidade</span>
            <input type="text" name="sigla_cidade" value="{% if perfil %}{{ perfil.sigla_cidade }}{% endif %}">
          </label>
          <label class="field">
            <span>ID_PLANTA (separados por virgula)</span>
            <input
              type="text"
              name="plantas"
              placeholder="PLANTA-001, PLANTA-002"
              value="{% if perfil %}{% for planta in perfil.plantas.all %}{{ planta.codigo }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}"
            >
          </label>
          <label class="field">
            <span>ID_FINANCEIRO (separados por virgula)</span>
            <input
              type="text"
              name="financeiros"
              placeholder="FIN-001, FIN-002"
              value="{% if perfil %}{% for fin in perfil.financeiros.all %}{{ fin.codigo }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}"
            >
          </label>
          <label class="field">
            <span>ID_INVENTARIO (separados por virgula)</span>
            <input
              type="text"
              name="inventarios"
              placeholder="INV-001, INV-002"
              value="{% if perfil %}{% for inv in perfil.inventarios.all %}{{ inv.codigo }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}"
            >
          </label>
          <button class="btn btn-primary" type="submit">Salvar perfil</button>
        </form>
      </div>

      <div class="card compact-card">
        <h2 style="margin-top: 0;">Senha</h2>
        <form method="post" class="stack">
          {% csrf_token %}
          <input type="hidden" name="action" value="set_password">
          <label class="field">
            <span>Nova senha</span>
            <input type="password" name="new_password" placeholder="Digite a nova senha">
          </label>
          <button class="btn btn-ghost" type="submit">Atualizar senha</button>
        </form>
      </div>
    </div>
  </section>
{% endblock %}
