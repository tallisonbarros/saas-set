{% extends "core/base.html" %}
{% load static %}

{% block title %}Propostas{% endblock %}

{% block breadcrumbs %}
  <nav class="page-crumbs" aria-label="Breadcrumb">
    <a href="{% url 'painel' %}">Painel</a>
    <span class="crumb-sep">/</span>
    <span>Propostas</span>
  </nav>
{% endblock %}

{% block content %}
  <section class="card stack">
    <div class="page-hud proposal-hero">
      <div class="hud-top">
        <div class="hud-title">Painel de propostas</div>
        <div class="hud-pill">Carteira comercial</div>
        <div class="hud-menu" aria-label="Menu do modulo">
          <a class="hud-menu-pill hud-menu-primary" href="{% url 'proposta_nova_vendedor' %}">Criar proposta</a>
        </div>
      </div>
      <div class="page-hud-head">
        <div>
          <h1 class="page-title" data-proposta-title>
            {% if tipo_ativo == "enviadas" %}Propostas enviadas{% else %}Propostas recebidas{% endif %}
          </h1>
          <p class="page-subtitle" data-proposta-subtitle>
            {% if tipo_ativo == "enviadas" %}
              Propostas que voce enviou para clientes e esta acompanhando o retorno.
            {% else %}
              Propostas que chegaram para voce aprovar, responder ou acompanhar.
            {% endif %}
          </p>
        </div>
      </div>
      <div class="hud-meta">
        <strong>{{ cliente.nome }}</strong>{% if cliente.empresa %} - {{ cliente.empresa }}{% endif %} - {{ cliente.email }}
      </div>
    </div>
    <div class="proposal-summary-grid" data-proposta-summary>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="pendentes">
          {% if tipo_ativo == "enviadas" %}Aguardando resposta{% else %}Pendentes para voce{% endif %}
        </div>
        <div class="summary-value" data-summary-value="pendentes">{{ quick_stats.pendentes|default:"0" }}</div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="execucao">
          {% if tipo_ativo == "enviadas" %}Em negociacao{% else %}Em analise{% endif %}
        </div>
        <div class="summary-value" data-summary-value="execucao">{{ quick_stats.em_execucao|default:"0" }}</div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="total">
          {% if tipo_ativo == "enviadas" %}Total enviadas{% else %}Total recebidas{% endif %}
        </div>
        <div class="summary-value" data-summary-value="total">{{ quick_stats.total|default:"0" }}</div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="finalizadas_90">Finalizadas (90 dias)</div>
        <div class="summary-value" data-summary-value="finalizadas_90">{{ quick_stats.finalizadas_90|default:"0" }}</div>
      </div>
    </div>
    {% if not cliente %}
      <p>Usuario sem cliente associado. Fale com o administrador.</p>
    {% else %}
      <div class="proposal-tabs" role="tablist" aria-label="Tipo de propostas">
        <div class="proposal-tabs-title">Modo</div>
        <div class="proposal-tab-list">
          <button
            class="proposal-tab{% if tipo_ativo == 'recebidas' %} active{% endif %}"
            type="button"
            data-proposta-tab="recebidas"
            aria-pressed="{% if tipo_ativo == 'recebidas' %}true{% else %}false{% endif %}"
          >
            Recebidas
          </button>
          <button
            class="proposal-tab{% if tipo_ativo == 'enviadas' %} active{% endif %}"
            type="button"
            data-proposta-tab="enviadas"
            aria-pressed="{% if tipo_ativo == 'enviadas' %}true{% else %}false{% endif %}"
          >
            Enviadas
          </button>
        </div>
      </div>
      <div class="proposal-filter-row">
        <div class="filters"></div>
        <form class="proposal-search" method="get">
          <input type="hidden" name="mode" value="{{ tipo_ativo }}">
          <input type="hidden" name="status" value="{{ status_filter|default:'' }}">
          <input
            type="search"
            name="q"
            value="{{ search_term }}"
            data-proposta-search
            placeholder="Buscar por codigo / nome / email"
            aria-label="Buscar propostas"
          >
          <button class="btn btn-ghost btn-compact" type="submit">Buscar</button>
        </form>
      </div>
      <div
        id="proposal-listings"
        class="proposal-listings"
        data-propostas-url="{% url 'propostas_data' %}"
        data-mode="{{ tipo_ativo }}"
        data-status="{{ status_filter|default:'' }}"
        data-search="{{ search_term|default:'' }}"
      >
        {% include "core/propostas/_sections.html" %}
      </div>
    {% endif %}
  </section>
{% endblock %}

{% block scripts %}
  <script src="{% static 'core/propostas.js' %}"></script>
{% endblock %}
