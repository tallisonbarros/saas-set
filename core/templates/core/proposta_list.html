{% extends "core/base.html" %}
{% load static %}

{% block title %}Propostas{% endblock %}

{% block breadcrumbs %}
  <nav class="page-crumbs" aria-label="Breadcrumb">
    <a href="{% url 'painel' %}">Painel</a>
    <span class="crumb-sep">/</span>
    <span>Propostas</span>
  </nav>
{% endblock %}

{% block content %}
  <section class="card stack">
    <div class="page-hud proposal-hero">
      <div class="hud-top">
        <div class="hud-title">Painel de propostas</div>
        <div class="hud-pill">Carteira comercial</div>
        <div class="hud-menu" aria-label="Menu do modulo">
          <a class="hud-menu-pill hud-menu-primary" href="{% url 'proposta_nova_vendedor' %}">Criar proposta</a>
          <a class="hud-menu-pill" href="{% url 'propostas_busca' %}?mode={{ tipo_ativo }}">Buscar propostas</a>
        </div>
      </div>
      <div class="page-hud-head">
        <div>
          <h1 class="page-title" data-proposta-title>
            {% if tipo_ativo == "enviadas" %}Propostas enviadas{% else %}Propostas recebidas{% endif %}
          </h1>
          <p class="page-subtitle" data-proposta-subtitle>
            {% if tipo_ativo == "enviadas" %}
              Propostas que voce enviou para clientes e esta acompanhando o retorno.
            {% else %}
              Propostas que chegaram para voce aprovar, responder ou acompanhar.
            {% endif %}
          </p>
        </div>
      </div>
      <div class="hud-meta">
        <strong>{{ cliente.nome }}</strong>{% if cliente.empresa %} - {{ cliente.empresa }}{% endif %} - {{ cliente.email }}
      </div>
    </div>
    <div class="proposal-summary-grid" data-proposta-summary>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="pendentes">
          {% if tipo_ativo == "enviadas" %}Aguardando cliente{% else %}Para decidir agora{% endif %}
        </div>
        <div class="summary-value" data-summary-value="pendentes">{{ quick_stats.pendentes|default:"0" }}</div>
        <div class="summary-hint" data-summary-hint="pendentes">
          {% if tipo_ativo == "enviadas" %}
            {{ quick_stats.pendentes|default:"0" }} aguardando retorno
          {% else %}
            {{ quick_stats.pendentes|default:"0" }} com valor e sem decisao
          {% endif %}
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="execucao">
          Em levantamento
        </div>
        <div class="summary-value" data-summary-value="execucao">{{ quick_stats.em_execucao|default:"0" }}</div>
        <div class="summary-hint" data-summary-hint="execucao">{{ quick_stats.em_execucao|default:"0" }} ainda sem valor definido</div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="total">
          {% if tipo_ativo == "enviadas" %}Em execucao{% else %}Aprovadas para executar{% endif %}
        </div>
        <div class="summary-value" data-summary-value="total">{{ quick_stats.total|default:"0" }}</div>
        <div class="summary-hint" data-summary-hint="total">
          {% if tipo_ativo == "enviadas" %}
            {{ quick_stats.total|default:"0" }} em execucao agora
          {% else %}
            {{ quick_stats.total|default:"0" }} prontas para iniciar execucao
          {% endif %}
        </div>
      </div>
      <div class="summary-card">
        <div class="summary-label" data-summary-label="finalizadas_90">
          {% if tipo_ativo == "enviadas" %}Taxa de aprovacao (30 dias){% else %}Concluidas (30 dias){% endif %}
        </div>
        <div class="summary-value" data-summary-value="finalizadas_90">{{ quick_stats.finalizadas_90|default:"0" }}</div>
        <div class="summary-hint" data-summary-hint="finalizadas_90">
          {% if tipo_ativo == "enviadas" %}
            {{ quick_stats.finalizadas_90|default:"0" }} de aprovacao no periodo
          {% else %}
            {{ quick_stats.finalizadas_90|default:"0" }} concluidas nos ultimos 30 dias
          {% endif %}
        </div>
      </div>
    </div>
    {% if not cliente %}
      <p>Usuario sem cliente associado. Fale com o administrador.</p>
    {% else %}
      <div class="proposal-tabs" role="tablist" aria-label="Tipo de propostas">
        <div class="proposal-tabs-title">Modo</div>
        <div class="proposal-tab-list">
          <button
            class="proposal-tab{% if tipo_ativo == 'recebidas' %} active{% endif %}"
            type="button"
            data-proposta-tab="recebidas"
            aria-pressed="{% if tipo_ativo == 'recebidas' %}true{% else %}false{% endif %}"
          >
            Recebidas
          </button>
          <button
            class="proposal-tab{% if tipo_ativo == 'enviadas' %} active{% endif %}"
            type="button"
            data-proposta-tab="enviadas"
            aria-pressed="{% if tipo_ativo == 'enviadas' %}true{% else %}false{% endif %}"
          >
            Enviadas
          </button>
        </div>
      </div>
      <div
        id="proposal-listings"
        class="proposal-listings"
        data-propostas-url="{% url 'propostas_data' %}"
        data-mode="{{ tipo_ativo }}"
      >
        {% include "core/propostas/_sections.html" %}
      </div>
    {% endif %}
  </section>
{% endblock %}

{% block scripts %}
  <script src="{% static 'core/propostas.js' %}"></script>
{% endblock %}
