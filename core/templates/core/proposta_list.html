{% extends "core/base.html" %}
{% load static %}

{% block title %}Propostas{% endblock %}

{% block content %}
  <section class="card stack">
    <div class="client-meta">
      {% if cliente.logo %}
        <img src="{{ cliente.logo.url }}" alt="Logo">
      {% endif %}
      <div>
        <div><strong>{{ cliente.nome }}</strong></div>
        {% if cliente.empresa %}
          <div class="muted">{{ cliente.empresa }}</div>
        {% endif %}
        <div class="muted">{{ cliente.email }}</div>
      </div>
    </div>
    {% if not cliente %}
      <p>Usuario sem cliente associado. Fale com o administrador.</p>
    {% else %}
      <div class="filters">
        <a href="{% url 'propostas' %}" class="filter-pill {% if not status_filter %}active{% endif %}">Todas</a>
        <a href="{% url 'propostas' %}?status=PENDENTE" class="filter-pill {% if status_filter == 'PENDENTE' %}active{% endif %}">Pendentes</a>
        <a href="{% url 'propostas' %}?status=LEVANTAMENTO" class="filter-pill {% if status_filter == 'LEVANTAMENTO' %}active{% endif %}">Levantamento</a>
        <a href="{% url 'propostas' %}?status=EXECUTANDO" class="filter-pill {% if status_filter == 'EXECUTANDO' %}active{% endif %}">Executando</a>
        <a href="{% url 'propostas' %}?status=APROVADA" class="filter-pill {% if status_filter == 'APROVADA' %}active{% endif %}">Aprovadas</a>
        <a href="{% url 'propostas' %}?status=REPROVADA" class="filter-pill {% if status_filter == 'REPROVADA' %}active{% endif %}">Reprovadas</a>
        <a href="{% url 'propostas' %}?status=FINALIZADO" class="filter-pill {% if status_filter == 'FINALIZADO' %}active{% endif %}">Finalizadas</a>
      </div>
      {% if propostas %}
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Prioridade</th>
              <th class="col-valor">Valor</th>
              <th>Status</th>
              <th>Acoes</th>
            </tr>
          </thead>
          <tbody>
            {% for proposta in propostas %}
              <tr>
                <td><a href="{% url 'proposta_detail' proposta.pk %}">{{ proposta.nome }}</a></td>
                <td>{{ proposta.prioridade }}</td>
                <td class="col-valor">R$ {{ proposta.valor }}</td>
                <td>
                  <span class="badge badge-{{ proposta.status|lower }}">{{ proposta.get_status_display }}</span>
                </td>
                <td class="actions-cell">
                  {% if proposta.status == "PENDENTE" %}
                    <form method="post" action="{% url 'aprovar_proposta' proposta.pk %}">
                      {% csrf_token %}
                      <button class="btn btn-primary" type="submit">Aprovar</button>
                    </form>
                    <form method="post" action="{% url 'reprovar_proposta' proposta.pk %}">
                      {% csrf_token %}
                      <button class="btn btn-outline" type="submit">Reprovar</button>
                    </form>
                  {% endif %}
                  <a class="btn btn-ghost" href="{% url 'proposta_detail' proposta.pk %}">Abrir detalhes</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      {% if status_filter %}
        <p>Sem propostas para o filtro selecionado.</p>
        {% else %}
          <p>Sem propostas no momento.</p>
        {% endif %}
      {% endif %}
    {% endif %}
  </section>
{% endblock %}
